{% extends 'base.html' %}
{% load FSforms %}
{% load staticfiles %}

{% block header %}

<script type="text/javascript" src="{% static "jquery.blockUI.js" %}"></script>
<script type="text/javascript">
    $(function(){
        $("#folderInput").click(function(){
            $('#dirDialog').dialog("open");
        });

        $(document).ajaxStop($.unblockUI);

    });

    function selectFolder(result){
        $("#folderInput").val( result)
    }

    function sendRequest(target){
        $.blockUI({message:"<h1>Processing...</h1>"});
        $.post('/reduce/'+target,$('#zdForm').serialize(),
            function(data){
                if( data.ok ){
                    alert("Success!");
                } else {
                    alert("Error: "+data.error);
                }
            }).fail(function(xhr,stat,error){
                alert('Error: '+stat +" , "+error);
                });
    }

</script>
<style type="text/css">
    #folderInput {
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<h1>Zero and Dark Reduction</h1>
<form id="zdForm">
    {% csrf_token %}
    <table>
    <tr><td><label>Folder to Process:</label><td><input name="path" id="folderInput" type="text" value="" autocomplet="off" readonly/></td></tr>
    <tr><td><input type="button" value="Rename files" onclick="sendRequest('renameAll')" /></td>
    <td><input type="button" value="Do First Pass" onclick="sendRequest('firstPass')" /></td>
    </tr>
    <tr><td><input type="button" value="Make master Zero" onclick="sendRequest('makeZero')"</td></tr>
    <tr><td><input type="button" value="Make master Dark" onclick="sendRequest('makeDark')" /> </td></tr>
    <tr><td><input type="button" value="Make master Flats" onclick="sendRequest('makeFlats')" /> </td></tr>
    <tr><td><input type="button" value="Subtract Zeros and Darks" onclick="sendRequest('subZeroDark')" /> </td></tr>
</form>

{% dirChooserDialog 'dirDialog' 'selectFolder' %}
{% endblock %}
